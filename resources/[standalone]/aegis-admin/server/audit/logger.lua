Aegis = Aegis or {}; Aegis.Audit = Aegis.Audit or {}; local function append(obj) local line=json.encode(obj)..'\n'; local ex=LoadResourceFile(GetCurrentResourceName(),'logs/audit.jsonl') or '' SaveResourceFile(GetCurrentResourceName(),'logs/audit.jsonl',ex..line,-1) end function Aegis.Audit.Log(actor,target,cap,params,success,reason,diff) local e={ts=os.time(),actor=actor,target=target,capability=cap,params=params or {},success=success and true or false,reason=reason,diff=diff} append(e); TriggerEvent('aegis:audit:entry', e) end