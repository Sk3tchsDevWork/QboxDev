Aegis = Aegis or {}; Aegis.Audit = Aegis.Audit or {}; Aegis.Audit.WebhookURL = nil AddEventHandler('aegis:audit:entry', function(entry) local url = (Config and Config.Discord and Config.Discord.AuditWebhook) or Aegis.Audit.WebhookURL if not url then return end PerformHttpRequest(url,function() end,'POST',json.encode({ username='Aegis Audit', embeds={{ title=('%s'):format(entry.capability or entry.cap), description=('Actor **%s** -> Target **%s**'):format(entry.actor, tostring(entry.target)), fields={{ name='Reason', value=tostring(entry.reason or 'n/a') }, { name='Diff', value='```json\n'..json.encode(entry.diff or {})..'```' }}, color=(Config.Discord.Embeds and Config.Discord.Embeds.color) or 16763904, footer={ text=(Config.Discord.Embeds and Config.Discord.Embeds.footer) or 'Aegis Admin' }, timestamp=os.date('!%Y-%m-%dT%H:%M:%SZ', entry.ts) }} }), {['Content-Type']='application/json'}) end)